#!/usr/bin/env python3
# coding=utf-8
import sys
import requests
import hashlib
import string

# Validate that the backend is a Keybase Stealer

# page usuals
pages = ["post.php", "login.php" ]


def page2folder(arg):
    """
    Remove a page from uri

    args:
        arg (str) string
    return
        str
    """
    arg = arg.split("/")
    return "/".join(arg[:-1])


# Functions
def getparam(count):
    """Retrieve the parameters appended """
    if len(sys.argv) != count + 1:
        print('give only the suspected URI')
        print('To Use: %s my params' % sys.argv[0])
        sys.exit(1)
    else:
        return sys.argv[1]


def get(uri):
    try:
        r = requests.get(uri, timeout=5)
    except:
        return 000, ""
    return r.status_code, r.text


def notkeybase():
    print('Not Keybase')
    sys.exit(1)


def keybase():
    print('!! Keybase backend')
    sys.exit(0)


def checkkeybase(uri):
    baseuri = page2folder(uri)
    for page in pages:
        print("  - Fetch %s on %s" % (page, baseuri)),
        code, body = get(baseuri +"/"+ page)
        if code != 200:
            notkeybase()
    if "<title>KeyBase: Login</title>" not in body:
        notkeybase()
    keybase()


# Main Code #####
def main():
    uri = getparam(1)
    checkkeybase(uri)


if __name__ == '__main__':
    main()
